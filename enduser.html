<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦æ§åˆ¶å° (Debug Console)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h2 { border-bottom: 2px solid #555; padding-bottom: 10px; width: 100%; text-align: center; }
        .status { margin-bottom: 20px; color: #888; font-size: 0.9rem; }
        .online { color: #0f0; font-weight: bold; }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        button {
            padding: 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, opacity 0.2s;
        }
        button:active { transform: scale(0.98); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-normal { background: linear-gradient(90deg, #00479d, #0080ff); color: white; }
        .btn-vip1 { background: linear-gradient(90deg, #ffd700, #ffaa00); color: black; }
        .btn-vip2 { background: linear-gradient(90deg, #ffcc00, #ff8800); color: black; }
        .btn-auto { background: linear-gradient(90deg, #f58025, #ff4500); color: white; }
        .btn-stop { background: #555; color: white; }

        .log-box {
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
            height: 200px;
            background: #000;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.8rem;
            color: #0f0;
        }
    </style>
</head>
<body>

    <h2>ğŸ› ï¸ KGI æ‹¼åœ–æ¸¬è©¦æ§åˆ¶å°</h2>
    <div id="status" class="status">é€£ç·šä¸­...</div>

    <div class="btn-group">
        <button class="btn-normal" onclick="sendRandomStaff()">ğŸ‘¤ ç™¼é€ 1 ç­†éš¨æ©Ÿä¸»ç®¡ç¥ç¦</button>
        <button class="btn-vip1" onclick="sendVIP('ç‹è‘£äº‹é•·')">â­ ç™¼é€ã€Œç‹è‘£äº‹é•·ã€ (è§¸ç™¼æ˜Ÿæ˜Ÿ)</button>
        <button class="btn-vip2" onclick="sendVIP('éƒ­ç¸½ç¶“ç†')">â­ ç™¼é€ã€Œéƒ­ç¸½ç¶“ç†ã€ (è§¸ç™¼ä¸‹è¼‰)</button>
        
        <hr style="width:100%; border-color:#333;">
        
        <button id="btnAuto" class="btn-auto" onclick="toggleAutoFill()">ğŸš€ æ¥µé€Ÿå¡«æ»¿ (æ¯ 0.1 ç§’ä¸€ç­†)</button>
    </div>

    <div class="log-box" id="logBox">
        [System] ç­‰å¾…é€£ç·š...
    </div>

    <script>
        // === è¨­å®š (éœ€èˆ‡ Display ä¸€è‡´) ===
        const broker = "broker.emqx.io";
        const port = 8084;
        const topic = "kgi_event_2025_live_demo";
        
        // æ¨¡æ“¬è³‡æ–™åº«
        const departments = ["è²¡å‹™éƒ¨", "è³‡è¨Šè™•", "æ¥­å‹™éƒ¨", "è¡ŒéŠ·éƒ¨", "äººè³‡éƒ¨", "æ³•éµéƒ¨", "é¢¨éšªç®¡ç†è™•", "æŠ•è³‡éƒ¨"];
        const names = ["é™³ç¶“ç†", "æ—å”ç†", "é»ƒå‰¯ç¸½", "å¼µå°ˆå“¡", "å³ç¸½ç›£", "æå‰¯ç†", "è”¡è¥„ç†"];
        const messages = [
            "æ¥­ç¸¾é•·ç´…ï¼Œå†å‰µé«˜å³°ï¼", "å‡±åŸºæ°¸çºŒï¼Œå…±ç¯‰æœªä¾†ï¼", "æ”œæ‰‹å‰è¡Œï¼Œæ¦®è€€å…±äº«", 
            "åœ˜éšŠåŒå¿ƒï¼Œå…¶åˆ©æ–·é‡‘", "å‰µæ–°çªç ´ï¼Œå¼•é ˜å¸‚å ´", "å¤§å®¶è¾›è‹¦äº†ï¼Œæ˜å¹´æ›´å¥½",
            "ç©©å¥ç¶“ç‡Ÿï¼ŒåŸºæ¥­é•·é’", "æ•¸ä½è½‰å‹ï¼Œæ•ˆç‡å€å¢"
        ];

        let client;
        let isConnected = false;
        let autoTimer = null;

        function connect() {
            const clientID = "tester_" + new Date().getTime();
            client = new Paho.MQTT.Client(broker, port, clientID);

            client.onConnectionLost = (res) => {
                document.getElementById('status').innerText = "âŒ é€£ç·šä¸­æ–·";
                document.getElementById('status').className = "status";
                isConnected = false;
            };

            client.connect({
                useSSL: true,
                onSuccess: () => {
                    document.getElementById('status').innerText = "ğŸŸ¢ é€£ç·šæˆåŠŸ (Ready)";
                    document.getElementById('status').className = "status online";
                    isConnected = true;
                    log("MQTT é€£ç·šæˆåŠŸ");
                },
                onFailure: (e) => {
                    document.getElementById('status').innerText = "âŒ é€£ç·šå¤±æ•—";
                    log("é€£ç·šå¤±æ•—: " + e.errorMessage);
                }
            });
        }

        // ç™¼é€è¨Šæ¯æ ¸å¿ƒå‡½æ•¸
        function publish(name, msg) {
            if (!isConnected) { alert("å°šæœªé€£ç·š"); return; }
            
            const payload = JSON.stringify({ name: name, msg: msg });
            const message = new Paho.MQTT.Message(payload);
            message.destinationName = topic;
            client.send(message);
            
            log(`ç™¼é€: ${name} - ${msg}`);
        }

        // 1. ç™¼é€éš¨æ©Ÿä¸»ç®¡
        function sendRandomStaff() {
            const dept = departments[Math.floor(Math.random() * departments.length)];
            const who = names[Math.floor(Math.random() * names.length)];
            const text = messages[Math.floor(Math.random() * messages.length)];
            publish(`${who} / ${dept}`, text);
        }

        // 2. ç™¼é€ VIP
        function sendVIP(vipName) {
            publish(vipName, "å¼•é ˜å‡±åŸºï¼Œé‚å‘å“è¶Šå·”å³°ï¼");
        }

        // 3. è‡ªå‹•å¡«æ»¿
        function toggleAutoFill() {
            const btn = document.getElementById('btnAuto');
            if (autoTimer) {
                // åœæ­¢
                clearInterval(autoTimer);
                autoTimer = null;
                btn.innerText = "ğŸš€ æ¥µé€Ÿå¡«æ»¿ (æ¯ 0.1 ç§’ä¸€ç­†)";
                btn.className = "btn-auto";
                btn.style.background = ""; // æ¢å¾©åŸè‰²
            } else {
                // é–‹å§‹
                btn.innerText = "â¹ åœæ­¢ç™¼é€";
                btn.className = "btn-stop";
                autoTimer = setInterval(() => {
                    sendRandomStaff();
                }, 100); // é€Ÿåº¦ï¼š100ms ä¸€ç­†
            }
        }

        function log(txt) {
            const box = document.getElementById('logBox');
            const p = document.createElement('div');
            p.innerText = `[${new Date().toLocaleTimeString()}] ${txt}`;
            box.insertBefore(p, box.firstChild);
        }

        // å•Ÿå‹•é€£ç·š
        connect();

    </script>
</body>
</html>
